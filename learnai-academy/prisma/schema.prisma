generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String              @id @default(uuid())
  email                      String              @unique
  createdAt                  DateTime            @default(now())
  updatedAt                  DateTime            @updatedAt
  image                      String?
  name                       String?
  password                   String?
  role                       String              @default("user")
  resetToken                 String?
  resetTokenExpiry           DateTime?
  tenantId                   String?
  reset_token                String?
  reset_token_expiry         DateTime?           @db.Timestamp(6)
  email_verified             Boolean?            @default(false)
  verification_token         String?
  verification_token_expires DateTime?           @db.Timestamp(6)
  verification_sent_at       DateTime?           @db.Timestamp(6)
  company                    String?
  is_admin                   Boolean?            @default(false)
  password_hash              String?
  created_at                 DateTime?           @default(now()) @db.Timestamp(6)
  updated_at                 DateTime?           @default(now()) @db.Timestamp(6)
  analytics_events           analytics_events[]
  api_keys                   api_keys[]
  generated_content          generated_content[]
  password_history           password_history[]
  platform_accounts          platform_accounts[]
  subscriptions              subscriptions?
  team_members               team_members[]
  teams                      teams[]
  tenants                    tenants?            @relation(fields: [tenantId], references: [id])

  @@index([created_at(sort: Desc)], map: "idx_users_created_at")
  @@index([email], map: "idx_users_email")
  @@index([reset_token], map: "idx_users_reset_token")
  @@index([verification_token], map: "idx_users_verification_token")
  @@index([tenantId])
  @@map("users")
}

model account_lockouts {
  id              Int       @id @default(autoincrement())
  email           String    @unique @db.VarChar(255)
  failed_attempts Int?      @default(0)
  locked_until    DateTime? @db.Timestamp(6)
  lockout_count   Int?      @default(0)
  last_attempt_at DateTime? @db.Timestamp(6)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)

  @@index([email], map: "idx_account_lockouts_email")
  @@index([locked_until], map: "idx_account_lockouts_locked_until")
}

model analytics_events {
  id        String   @id
  userId    String?
  event     String
  platform  String?
  metadata  Json?
  createdAt DateTime @default(now())
  tenantId  String?
  tenants   tenants? @relation(fields: [tenantId], references: [id])
  users     User?    @relation(fields: [userId], references: [id])

  @@index([tenantId])
}

model api_keys {
  id          String    @id
  userId      String
  name        String
  key         String    @unique
  permissions String[]
  lastUsed    DateTime?
  expiresAt   DateTime?
  createdAt   DateTime  @default(now())
  tenantId    String?
  tenants     tenants?  @relation(fields: [tenantId], references: [id])
  users       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model content_templates {
  id          String   @id
  name        String
  description String
  platform    String
  contentType String
  template    String
  variables   String[]
  category    String
  isPremium   Boolean  @default(false)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model demo_logs {
  id         Int       @id @default(autoincrement())
  ip_address String    @db.VarChar(45)
  email      String?   @db.VarChar(254)
  user_agent String?
  created_at DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_demo_logs_created_at")
  @@index([ip_address], map: "idx_demo_logs_ip")
  @@index([ip_address, created_at], map: "idx_demo_logs_ip_date")
}

model engagement_data {
  id                String            @id
  contentId         String            @unique
  platformPostId    String?
  likes             Int               @default(0)
  shares            Int               @default(0)
  comments          Int               @default(0)
  views             Int               @default(0)
  clicks            Int               @default(0)
  lastUpdated       DateTime          @default(now())
  generated_content generated_content @relation(fields: [contentId], references: [id], onDelete: Cascade)
}

model generated_content {
  id              String           @id
  userId          String
  platform        String
  contentType     String
  text            String
  images          String[]
  scheduledAt     DateTime?
  publishedAt     DateTime?
  status          String           @default("draft")
  metadata        Json?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  tenantId        String?
  engagement_data engagement_data?
  tenants         tenants?         @relation(fields: [tenantId], references: [id])
  users           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId, createdAt(sort: Desc)], map: "idx_generated_content_user_date")
}

model login_attempts {
  id             Int       @id @default(autoincrement())
  email          String    @db.VarChar(255)
  ip_address     String?   @db.Inet
  success        Boolean
  failure_reason String?   @db.VarChar(255)
  created_at     DateTime? @default(now()) @db.Timestamp(6)

  @@index([email, created_at(sort: Desc)], map: "idx_login_attempts_email")
  @@index([email, created_at(sort: Desc)], map: "idx_login_attempts_email_date")
  @@index([ip_address, created_at(sort: Desc)], map: "idx_login_attempts_ip")
  @@index([ip_address, created_at(sort: Desc)], map: "idx_login_attempts_ip_date")
}

model password_history {
  id            Int       @id @default(autoincrement())
  user_id       String
  password_hash String
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_password_history_created_at")
  @@index([user_id], map: "idx_password_history_user_id")
}

model plans {
  id                     Int       @id @default(autoincrement())
  name                   String
  description            String?
  price                  Decimal   @db.Decimal(10, 2)
  billing_interval       String
  features               Json?
  created_at             DateTime? @default(now()) @db.Timestamptz(6)
  updated_at             DateTime? @default(now()) @db.Timestamptz(6)
  price_monthly          Int?
  price_annual           Int?
  stripe_price_id        String?
  stripe_price_id_annual String?
  email_limit            Int?
  linkedin_limit         Int?
  bulk_upload            Boolean?  @default(false)
  sort_order             Int?      @default(0)
  is_active              Boolean?  @default(true)

  @@index([is_active], map: "idx_plans_active")
}

model platform_accounts {
  id           String    @id
  userId       String
  platform     String
  accountId    String
  accountName  String
  avatar       String?
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?
  isConnected  Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  tenantId     String?
  tenants      tenants?  @relation(fields: [tenantId], references: [id])
  users        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform, accountId])
  @@index([userId, platform, isConnected], map: "idx_platform_accounts_user")
  @@index([tenantId])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rate_limits {
  identifier   String    @id @db.VarChar(255)
  count        Int       @default(0)
  window_start DateTime  @db.Timestamp(6)
  window_end   DateTime  @db.Timestamp(6)
  last_attempt DateTime  @db.Timestamp(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)

  @@index([identifier, window_end], map: "idx_rate_limits_identifier_window")
  @@index([window_end], map: "idx_rate_limits_window_end")
}

model subscriptions {
  id                  String    @id
  userId              String    @unique
  plan                String
  status              String
  monthlyContentLimit Int       @default(50)
  monthlyAIRequests   Int       @default(100)
  stripeCustomerId    String?   @unique
  stripePriceId       String?
  currentPeriodStart  DateTime?
  currentPeriodEnd    DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  tenantId            String?
  tenants             tenants?  @relation(fields: [tenantId], references: [id])
  users               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status], map: "idx_subscriptions_user_status")
  @@index([tenantId])
}

model team_members {
  id       String   @id
  teamId   String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  teams    teams    @relation(fields: [teamId], references: [id], onDelete: Cascade)
  users    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
}

model teams {
  id           String         @id
  name         String
  ownerId      String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  team_members team_members[]
  users        User           @relation(fields: [ownerId], references: [id])
}

model tenants {
  id                String              @id
  name              String
  slug              String              @unique
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  analytics_events  analytics_events[]
  api_keys          api_keys[]
  generated_content generated_content[]
  platform_accounts platform_accounts[]
  subscriptions     subscriptions[]
  users             User[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model trial_logs {
  id         Int       @id @default(autoincrement())
  ip_address String    @db.VarChar(45)
  email      String    @db.VarChar(254)
  user_agent String?
  created_at DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_trial_logs_created_at")
  @@index([email], map: "idx_trial_logs_email")
  @@index([ip_address], map: "idx_trial_logs_ip")
  @@index([ip_address, created_at], map: "idx_trial_logs_ip_date")
}
